<!-- Add this script to the page to fix time loading -->
<script>
(function() {
    'use strict';
    
    console.log('üîß Inline time loading fix initializing...');
    
    // Wait for DOM to be ready
    function initTimeLoadingFix() {
        const dateInput = document.getElementById('booking-date');
        const timeSelect = document.getElementById('booking-time');
        
        if (!dateInput || !timeSelect) {
            console.log('‚è≥ Waiting for elements...');
            setTimeout(initTimeLoadingFix, 500);
            return;
        }
        
        console.log('‚úÖ Elements found, setting up time loading...');
        
        // Function to load time slots
        function loadTimeSlots() {
            const selectedDate = dateInput.value;
            if (!selectedDate) {
                console.log('üìÖ No date selected');
                return;
            }
            
            console.log(`üîÑ Loading times for date: ${selectedDate}`);
            
            // Get selected service
            const activeService = document.querySelector('.service-option.active');
            const serviceType = activeService?.getAttribute('data-service-type') || 
                               window.selectedService || 
                               '90min_massage';
            
            console.log(`üìç Service type: ${serviceType}`);
            
            // Show loading
            timeSelect.disabled = true;
            timeSelect.innerHTML = '<option value="">Loading times...</option>';
            
            const practitionerId = '060863f2-0623-4785-b01a-f1760cfb8d14';
            const url = `https://ittheal.com/api/web-booking/availability/${practitionerId}/${selectedDate}?service_type=${serviceType}`;
            
            console.log(`üåê API URL: ${url}`);
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log('üì¶ API Response:', data);
                    
                    if (data.success && data.data && data.data.available_slots && data.data.available_slots.length > 0) {
                        timeSelect.innerHTML = '<option value="">Select a time...</option>';
                        
                        data.data.available_slots.forEach(slot => {
                            const option = document.createElement('option');
                            const timeDate = new Date(slot.time);
                            const hours = String(timeDate.getUTCHours()).padStart(2, '0');
                            const minutes = String(timeDate.getUTCMinutes()).padStart(2, '0');
                            option.value = `${hours}:${minutes}`;
                            option.textContent = slot.display_time + (slot.duration ? ` (${slot.duration} min)` : '');
                            timeSelect.appendChild(option);
                        });
                        
                        timeSelect.disabled = false;
                        console.log(`‚úÖ Loaded ${data.data.available_slots.length} time slots`);
                    } else {
                        timeSelect.innerHTML = '<option value="">No times available</option>';
                        timeSelect.disabled = false;
                        console.log('‚ùå No available slots');
                    }
                })
                .catch(error => {
                    console.error('‚ùå Error loading times:', error);
                    timeSelect.innerHTML = '<option value="">Error loading times</option>';
                    timeSelect.disabled = false;
                });
        }
        
        // Attach event listeners
        dateInput.addEventListener('change', loadTimeSlots);
        dateInput.addEventListener('input', loadTimeSlots);
        
        // Listen for service selection
        document.addEventListener('serviceSelected', () => {
            if (dateInput.value) {
                loadTimeSlots();
            }
        });
        
        // Expose for manual testing
        window.manualLoadTimeSlots = loadTimeSlots;
        
        console.log('‚úÖ Time loading fix installed');
    }
    
    // Start initialization
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initTimeLoadingFix);
    } else {
        initTimeLoadingFix();
    }
})();
</script>